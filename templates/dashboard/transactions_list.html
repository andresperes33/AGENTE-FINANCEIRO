{% extends 'base.html' %}
{% load humanize %}
{% block title %}Transações{% endblock %}
{% block header_title %}Transações{% endblock %}
{% block content %}
<div class="space-y-6 max-w-full overflow-hidden">
    <!-- Filters Card -->
    <div class="bg-dark-lighter border border-dark-border rounded-xl p-4 md:p-6 shadow-sm">
        <form method="get" class="grid grid-cols-1 sm:grid-cols-2 lg:flex lg:items-end gap-4">
            <div class="flex-1 min-w-0">
                <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Tipo</label>
                <select name="type"
                    class="w-full bg-dark border border-dark-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all outline-none">
                    <option value="">Todos os Tipos</option>
                    {% if type_filter == 'income' %}
                    <option value="income" selected>Receitas (+)</option>
                    {% else %}
                    <option value="income">Receitas (+)</option>
                    {% endif %}
                    {% if type_filter == 'expense' %}
                    <option value="expense" selected>Despesas (-)</option>
                    {% else %}
                    <option value="expense">Despesas (-)</option>
                    {% endif %}
                </select>
            </div>
            <div class="flex-1 min-w-0">
                <label
                    class="block text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Categoria</label>
                <select name="category"
                    class="w-full bg-dark border border-dark-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all outline-none">
                    <option value="">Todas as Categorias</option>
                    {% for cat in categories %}
                    {% if category_filter == cat %}
                    <option value="{{ cat }}" selected>{{ cat }}</option>
                    {% else %}
                    <option value="{{ cat }}">{{ cat }}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div class="flex gap-2">
                <button type="submit"
                    class="flex-1 lg:flex-none inline-flex items-center justify-center px-6 py-2 rounded-lg font-bold bg-primary hover:bg-primary-dark text-white text-sm shadow-lg shadow-primary/20 h-[38px] transition-all active:scale-95 leading-none whitespace-nowrap">
                    <svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    Filtrar
                </button>
                <a href="{% url 'dashboard:transactions_list' %}"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-bold bg-dark-lighter hover:bg-slate-700 text-slate-200 border border-dark-border h-[38px] transition-all active:scale-95">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </a>
            </div>
        </form>
    </div>

    <!-- History Card -->
    <div class="bg-dark-lighter border border-dark-border rounded-xl shadow-sm overflow-hidden">
        <div
            class="p-4 md:p-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 border-b border-dark-border">
            <div>
                <h3 class="font-display text-xl font-bold text-white leading-tight">Histórico Financeiro</h3>
                <p class="text-xs text-slate-500 mt-1">Gerencie seus últimos lançamentos</p>
            </div>
            <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                <a href="{% url 'dashboard:export_excel' %}?type={{ type_filter|default:'' }}&category={{ category_filter|default:'' }}"
                    class="flex-1 sm:flex-none inline-flex items-center justify-center px-4 py-2.5 rounded-lg font-bold bg-dark-lighter hover:bg-slate-700 text-slate-300 border border-dark-border transition-all active:scale-95 text-xs uppercase tracking-wider"
                    title="Exportar para Excel">
                    <svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    Excel
                </a>
                <a href="{% url 'dashboard:transaction_create' %}"
                    class="flex-1 sm:flex-none inline-flex items-center justify-center px-4 py-2.5 rounded-lg font-bold bg-primary hover:bg-primary-dark text-white shadow-lg shadow-primary/30 transition-all active:scale-95 text-xs uppercase tracking-wider">
                    <svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Novo
                </a>
            </div>
        </div>

        {% if transactions %}
        <div class="overflow-x-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent">
            <table class="w-full text-left min-w-[700px]">
                <thead>
                    <tr
                        class="bg-dark/50 text-slate-400 uppercase text-[10px] font-bold tracking-[0.1em] border-b border-dark-border">
                        <th class="px-6 py-4">ID</th>
                        <th class="px-6 py-4">Data</th>
                        <th class="px-6 py-4">Descrição</th>
                        <th class="px-6 py-4">Status</th>
                        <th class="px-6 py-4 text-right">Valor</th>
                        <th class="px-6 py-4 text-center">Ações</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-dark-border/50">
                    {% for transaction in transactions %}
                    <tr class="group hover:bg-slate-800/20 transition-colors duration-200">
                        <td class="px-6 py-5 whitespace-nowrap"><span
                                class="bg-emerald-500/10 text-emerald-400 text-sm font-bold px-3 py-1.5 rounded-lg border border-emerald-500/30 font-mono shadow-sm">{{transaction.identifier }}</span></td>
                        <td class="px-6 py-5 whitespace-nowrap">
                            <div class="text-xs font-bold text-slate-400 font-mono tracking-tighter">{{transaction.transaction_date|date:"d/m/Y" }}</div>
                        </td>
                        <td class="px-6 py-5">
                            <div
                                class="font-bold text-slate-200 text-base group-hover:text-primary transition-colors leading-tight">
                                {{ transaction.description }}</div>
                            <div class="text-[11px] font-bold text-slate-500 uppercase mt-1 tracking-wider">{{transaction.category }}</div>
                        </td>
                        <td class="px-6 py-5">
                            {% if transaction.type == 'income' %}
                            <span
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-emerald-500/10 text-emerald-400 border border-emerald-500/20"><span
                                    class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>Receita</span>
                            {% else %}
                            <span
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-rose-500/10 text-rose-400 border border-rose-500/20"><span
                                    class="w-1.5 h-1.5 rounded-full bg-rose-400"></span>Despesa</span>
                            {% endif %}
                        </td>
                        <td
                            class="px-6 py-5 text-right whitespace-nowrap font-display text-lg font-bold {% if transaction.type == 'income' %}text-emerald-400{% else %}text-rose-400{% endif %}">
                            R$ {{ transaction.amount|floatformat:2 }}</td>
                        <td class="px-6 py-5">
                            <div class="flex justify-center items-center gap-2">
                                <a href="{% url 'dashboard:transaction_edit' transaction.pk %}"
                                    class="w-10 h-10 rounded-xl flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700 transition-all border border-dark-border shadow-sm"><svg
                                        width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg></a>
                                <a href="{% url 'dashboard:transaction_delete' transaction.pk %}"
                                    class="w-10 h-10 rounded-xl flex items-center justify-center text-slate-400 hover:text-rose-400 hover:bg-rose-500/10 transition-all border border-dark-border shadow-sm"><svg
                                        width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path
                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                        </path>
                                    </svg></a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="flex flex-col items-center justify-center py-24 px-6 text-center">
            <div
                class="w-20 h-20 bg-dark rounded-3xl flex items-center justify-center mb-6 border-2 border-dark-border shadow-inner">
                <svg class="text-slate-600" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-white mb-2 font-display tracking-tight">Vazio por aqui</h3>
            <p class="text-slate-500 max-w-[280px] mb-8 leading-relaxed text-sm">Não encontramos registros financeiros
                correspondentes.</p><a href="{% url 'dashboard:transaction_create' %}"
                class="inline-flex items-center justify-center px-10 py-3 rounded-xl font-bold bg-primary hover:bg-primary-dark text-white shadow-xl shadow-primary/20 transition-all uppercase text-xs tracking-widest">Registrar
                Agora</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}